<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>BeatSaver Playlist Parser</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: auto; padding: 1rem; }
    textarea { width: 100%; height: 400px; font-family: monospace; }
  </style>
</head>
<body>
  <h1>BeatSaver Playlist to Python Dictionary</h1>
  <input id="playlistUrl" type="text" placeholder="Enter BeatSaver playlist URL" size="80" />
  <button onclick="fetchPlaylist()">Convert</button>
  <h2>Output:</h2>
  <textarea id="output" readonly></textarea>

  <script>
    async function fetchPlaylist() {
      const input = document.getElementById("playlistUrl").value.trim();
      const match = input.match(/\/playlists\/([^/]+)/);
      if (!match) {
        alert("Invalid URL");
        return;
      }

      const playlistId = match[1];
      const apiUrl = `https://api.beatsaver.com/playlists/id/${playlistId}`;

      try {
        const response = await fetch(apiUrl);
        if (!response.ok) throw new Error("Playlist not found");
        const data = await response.json();

        const songs = data.songs || [];
        const lines = ['default_songs = {'];

        for (const song of songs) {
          const title = song.name;
          const songKey = song.key;
          const difficulty = song.metadata.difficulties.standard?.length
            ? song.metadata.difficulties.standard[0].difficulty
            : "Unknown";

          const diffNumeric = {
            Easy: 1, Normal: 2, Hard: 3, Expert: 4, ExpertPlus: 5
          }[difficulty] || 0;

          const songLine = `    "${title}": {\n` +
                           `        "levelid": "${songKey}",\n` +
                           `        "difficulty": ${diffNumeric},\n` +
                           `        "characteristic": "Standard"\n    },`;

          lines.push(songLine);
        }

        lines.push("}");

        document.getElementById("output").value = lines.join("\n");
      } catch (err) {
        console.error(err);
        alert("Error fetching playlist data");
      }
    }
  </script>
</body>
</html>
