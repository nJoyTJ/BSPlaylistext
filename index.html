<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>BeatSaver Playlist Parser</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: auto; padding: 1rem; }
    textarea { width: 100%; height: 400px; font-family: monospace; }
  </style>
</head>
<body>
  <h1>BeatSaver Playlist to Python Dictionary</h1>
  <input id="playlistUrl" type="text" placeholder="Enter BeatSaver playlist URL" size="80" />
  
  <select id="difficultyFilter">
  <option value="All">All Difficulties</option>
  <option value="Easy">Easy</option>
  <option value="Normal">Normal</option>
  <option value="Hard">Hard</option>
  <option value="Expert">Expert</option>
  <option value="ExpertPlus">ExpertPlus</option>
  </select>
  
  <button onclick="fetchPlaylist()">Convert</button>
  <h2>Output:</h2>
  <textarea id="output" readonly></textarea>

  <script>
  async function fetchPlaylist() {
    const input = document.getElementById("playlistUrl").value.trim();
    const match = input.match(/\/playlists\/([^/]+)/);
    if (!match) {
      alert("Invalid URL");
      return;
    }

    const playlistId = match[1];
    const outputBox = document.getElementById("output");
    outputBox.value = "Loading...";

    let page = 0;
    let allMaps = [];
    let playlistName = "";

    try {
      while (true) {
        const apiUrl = `https://api.beatsaver.com/playlists/id/${playlistId}/${page}`;
        const response = await fetch(apiUrl);
        if (!response.ok) break;

        const data = await response.json();
        if (page === 0 && data.playlist?.name) {
          playlistName = data.playlist.name;
        }

        const maps = data.maps || [];
        if (maps.length === 0) break;

        allMaps.push(...maps);
        page++;
      }

      if (allMaps.length === 0) {
        outputBox.value = "default_songs = {}";
        return;
      }

      const lines = ['default_songs = {'];

      const selectedDifficulty = document.getElementById("difficultyFilter").value;

      for (const mapEntry of allMaps) {
        const map = mapEntry.map || {};
        const metadata = map.metadata || {};
        const songTitle = `${metadata.songAuthorName || "Unknown Artist"} - ${metadata.songName || "Unknown Title"}`;
        const baseTitle = `[${playlistName || "Playlist"}] ${songTitle}`;

        const versions = map.versions || [];
        if (versions.length === 0) continue;

        const version = versions[0];
        const levelid = version.key || map.id || "UNKNOWN";
        const diffs = version.diffs || [];

      for (const diffObj of diffs) {
        const difficulty = diffObj.difficulty || "Unknown";
        if (selectedDifficulty !== "All" && selectedDifficulty !== difficulty) continue;

        const difficultyMap = {
          Easy: 1,
          Normal: 2,
          Hard: 3,
          Expert: 4,
          ExpertPlus: 5
        };

        const characteristic = diffObj.characteristic || "Standard";
        const diffNumeric = difficultyMap[difficulty] || 0;

        const fullTitle = `${baseTitle} [${difficulty}]`;

        lines.push(`    "${fullTitle}": {`);
        lines.push(`        "levelid": "${levelid}",`);
        lines.push(`        "difficulty": ${diffNumeric},`);
        lines.push(`        "characteristic": "${characteristic}"`);
        lines.push(`    },`);
      }
    }
}

      lines.push("}");
      outputBox.value = lines.join("\n");

    } catch (err) {
      console.error("Error:", err);
      alert("Error fetching playlist data");
      outputBox.value = "default_songs = {}";
    }
  }
  </script>
</body>
</html>
