<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>BeatSaver Playlist Parser</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: auto; padding: 1rem; }
    textarea { width: 100%; height: 400px; font-family: monospace; }
  </style>
</head>
<body>
  <h1>BeatSaver Playlist to Python Dictionary</h1>
  <input id="playlistUrl" type="text" placeholder="Enter BeatSaver playlist URL" size="80" />
  <button onclick="fetchPlaylist()">Convert</button>
  <h2>Output:</h2>
  <textarea id="output" readonly></textarea>

  <script>
  async function fetchPlaylist() {
    const input = document.getElementById("playlistUrl").value.trim();
    const match = input.match(/\/playlists\/([^/]+)/);
    if (!match) {
      alert("Invalid URL");
      return;
    }

    const playlistId = match[1];
    const outputBox = document.getElementById("output");
    outputBox.value = "Loading...";

    let page = 0;
    let allSongs = [];

    try {
      while (true) {
        const apiUrl = `https://api.beatsaver.com/playlists/id/${playlistId}/${page}`;
        const response = await fetch(apiUrl);
        if (!response.ok) break;

        const data = await response.json();
        const songs = data.songs || [];

        if (songs.length === 0) break;

        allSongs.push(...songs);
        page++;
      }

      if (allSongs.length === 0) {
        outputBox.value = "default_songs = {}";
        return;
      }

      const lines = ['default_songs = {'];

      for (const song of allSongs) {
        const title = song.name || "Unknown Title";
        const key = song.key || "UNKNOWN";
        const versions = song.versions || [];

        let diffNumeric = 0;
        let characteristic = "Standard";

        if (versions.length > 0 && versions[0].diffs.length > 0) {
          const diffObj = versions[0].diffs.find(d => d.characteristic === "Standard") || versions[0].diffs[0];
          const difficulty = diffObj.difficulty || "Unknown";
          characteristic = diffObj.characteristic || "Standard";

          const difficultyMap = {
            Easy: 1, Normal: 2, Hard: 3, Expert: 4, ExpertPlus: 5
          };

          diffNumeric = difficultyMap[difficulty] || 0;
        }

        lines.push(`    "${name}": {`);
        lines.push(`        "levelid": "${id}",`);
        lines.push(`        "difficulty": ${sageScore},`);
        lines.push(`        "characteristic": "${characteristic}"`);
        lines.push(`    },`);
      }

      lines.push("}");
      outputBox.value = lines.join("\n");

    } catch (err) {
      console.error(err);
      alert("Error fetching playlist data");
      outputBox.value = "default_songs = {}";
    }
  }
</script>
</body>
</html>
